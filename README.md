# PBNYC Voter Turnout

This is the repository for code for the article "Participatory Budgeting and Voter Turnout" in the journal _Political Behavior_.

All scripts required to replicate the analysis are in the main project directory. Data collection and cleaning scripts and code to scrape the NYC BOE website to generate competitiveness measures are in `R_data_collection` and `R_competitiveness` directories respectively.

To replicate the analysis, clone or fork this repository. The de-identified individual-level data can be obtained upon request by emailing info@nycet.org with the subject line "Requesting replication data for PB voter turnout study".  The voterfile_full_clean_deid.rds file provided should be saved into the data/cleaned_R_results directory.  

To replicate the analysis, start at step 1 as enumerated in the table below.  This table outlines all scripts and script/data dependencies that must be run in sequence to replicate the results.

| Order | Script                                                   | Summary                                                                                                                                                                                                                                     | Scripts called                                                                                                                                                                   | Data in                                                                                                                                                                                      | Data out                                                                                             | Fig/table out                                                                       |
| ----- | -------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------- |
| 0-    | R\_data\_collection/rr\_vf\_processing\_full.R           | Creates the full voterfile with all auxiliary information except ED turnout. This file and dependencies are not needed to run replication, are included for transparency in dataset creation.                                               | vf\_gis\_nyccdmatch.R<br>pb\_cleanup\_addnyccd\_foranalysis.R<br>rr\_vf\_aux\_processing.R<br>(R\_data\_collection\_/rr\_working\_district\_match.R for district match\_res.rds) | personfile,<br>pb data,<br>pb\_district\_votes.csv,<br>district\_match\_res.rds<br>                                                                                                          | cleaned\_R\_results/voterfile\_full\_clean\_deid.rds                                                       |
| 0a    | R\_data\_collection/vf\_gis\_nyccdmatch.R                |                                                                                                                                                                                                                                             |                                                                                                                                                                                  | shapefiles/nycc\_18c/nycc.shp,<br>ed-nyccd-map.csv                                                                                                                                           |                                                                                                      |                                                                                     |
| 0b    | R\_data\_collection/pb\_cleanup\_addnyccd\_foranalysis.R |                                                                                                                                                                                                                                             | ed-nyccd-map.csv,<br>pbnyc\_district\_votes.csv                                                                                                                                  |                                                                                                                                                                                              |                                                                                                      |
| 0c    | R\_data\_collection/rr\_vf\_aux\_processing.R            |                                                                                                                                                                                                                                             | R\_data\_collection/censustables.R<br>BOE\_pres\_process.R                                                                                                                       | voters\_census.rds,<br>wide\_compet\_clean\_deid.rds,<br>council\_districts.rds                                                                                                                    |                                                                                                      |                                                                                     |
| 0c-1  | R\_data\_collection/censustables.R                       | Downloads ACS data for NYC census tracts                                                                                                                                                                                                    |                                                                                                                                                                                  |                                                                                                                                                                                              | census.Rdata                                                                                         |                                                                                     |
| 0c-2  | R\_competitiveness/BOE\_pres\_process.R                  | Attached presidential election margins to city/district election data                                                                                                                                                                       |                                                                                                                                                                                  | data/pres\_elec\_res.csv                                                                                                                                                                     |                                                                                                      |                                                                                     |
| 0d    | R\_data\_collection/rr\_working\_district\_match.R       | matching districts by district-level characteristics to identify most-similar match groups                                                                                                                                                  |                                                                                                                                                                                  | voterfile\_for\_matching.rds,<br>council\_districts\_wmargin.rds,<br>pbnyc\_district\_votes                                                                                                  | district\_match\_res.rds                                                                             |                                                                                     |
| 1-    | rr\_vf\_processing\_for\_matching.R                      | \*Start Here\*<br>Splits full voterfile into comparison sets (suffix = "" (main), suffix = "\_placebo", suffix = "within\_dist")                                                                                                            |                                                                                                                                                                                  | voterfile\_full\_clean\_deid.rds,<br>pbdistricts.rds, <br>pbnyc_district_votes.csv                                                                                                                                               | voter\_file\_for\_matching\_SUFFIX.rds                                                               |                                                                                     |
| 2-    | rr\_vf\_matching\_iterate                                | File to execute iterated matching with different match specifications. Must be rerun for each major comparison framework (suffix = "" (main), suffix = "within\_dist")                                                                      | rr\_exact\_match.R,<br>rr\_matching\_levels\_SUFFIX.R<br>rr\_matching\_functions.R                                                                                               | voterfile\_for\_matching\_SUFFIX.rds,<br>matchablevans\_SUFFIX.rds (created by rr\_exact\_match.R)                                                                                           | matching\_res\_SUFFIX.rds                                                                            |                                                                                     |
| 2a    | rr\_exact\_match.R                                       | File to run exact match to find possible subset of matchable IDs to speed up coarsened match                                                                                                                                                |                                                                                                                                                                                  |                                                                                                                                                                                              | matchablevans\_SUFFIX.rds                                                                            |                                                                                     |
| 2b    | rr\_matching\_levels\_SUFFIX.R                           | Setting match levels and loading cutpoints for each match                                                                                                                                                                                   | rr\_matching\_cutpoints.R creates the cutpoints file used here<br>                                                                                                               | cutpoints.Rdata                                                                                                                                                                              |                                                                                                      |                                                                                     |
| 2b-1  | rr\_matching\_cutpoints.R                                | Calculating population based cutoff values for CEM matching                                                                                                                                                                                 |                                                                                                                                                                                  | voterfile\_full\_clean\_deid.rds                                                                                                                                                                   | cutpoints.Rdata                                                                                      |                                                                                     |
| 3-    | rr\_vf\_regression\_iterate.R                            | Load data, attach ED-level competitiveness measures, iterate over regression models and save results, rerun for each comparison framework (suffix = "" (main), suffix = "within\_dist")                                                     | create\_pb\_long.R,<br>rr\_regression\_functions.R                                                                                                                               | matching\_res\_SUFFIX.RDS,<br>voterfile\_for\_matching\_SUFFIX.rds                                                                                                                           | iter\_regress\_check\_SUFFIX.rds (full models),<br>iter\_regress\_lmers\_SUFFIX.rds (just summaries) |                                                                                     |
| 3-2   | rr\_vf\_regression\_iterate\_placebo.R                   | iterated regressions for placebo model; data structure, functions and model slightly differ because no variable start to PB (district-wide); Note this is VERY memory-hungry - I had to run on a 32G memory machine                         | create\_pb\_long\_placebo.R,<br>rr\_regression\_functions.R                                                                                                                      | matching\_res\_placebo.RDS,<br>voterfile\_for\_matching\_placebo.rds                                                                                                                         | iter\_regress\_check\_placebo.rds,<br>iter\_regress\_lmers\_placebo.rds                              |                                                                                     |
| 3-2a  | create\_pb\_long\_placebo.R                              | reshape voterfile long for regression for placebo model                                                                                                                                                                                     |                                                                                                                                                                                  |                                                                                                                                                                                              |                                                                                                      |                                                                                     |
| 3a    | create\_pb\_long.R                                       | main function to reshape file long for regression                                                                                                                                                                                           |                                                                                                                                                                                  |                                                                                                                                                                                              |                                                                                                      |                                                                                     |
| 3b    | rr\_regression\_functions.R                              | general functions to preprecess data and run regressions                                                                                                                                                                                    |                                                                                                                                                                                  |                                                                                                                                                                                              |                                                                                                      |                                                                                     |
| 4     | rr\_vf\_regression\_compare\_method.R                    | load all iterated models and create comparison fig for paper                                                                                                                                                                                |                                                                                                                                                                                  | iter\_regress\_lmers\_within\_dist.rds,<br>iter\_regress\_lmers\_placebo.rds,<br>iter\_regress\_lmers.rds                                                                                    |                                                                                                      | Paper\_text/Figs/robust\_compare.pdf                                                |
| 5     | rr\_vf\_regression\_final.R                              | Load data, attach ED-level competitiveness measures, and run regression models presented in paper.                                                                                                                                          | create\_pb\_long.R,<br>rr\_regression\_functions.R                                                                                                                               | matching\_res.RDS,<br>voterfile\_for\_matching.rds                                                                                                                                           | main\_effects.rds                                                                                    | mainregs\_raw.tex                                                                   |
| 6     | rr\_vf\_regression\_preds.R                              | Reruns main regression AND subgroup interactions in full dummy format for prediction and visualizations use with Chris Adolph's simcf & tile packages (http://faculty.washington.edu/cadolph/?page=60 still so useful for model inference!) | create\_pb\_long.R,<br>rr\_regression\_functions.R                                                                                                                               | matching\_res.RDS,<br>voterfile\_for\_matching.rds                                                                                                                                           | data/temp/subgroup\_res\_tractfine.rds                                                               | group\_fds\_bothyears.pdf (and many other intermediate figs),<br>subgroups\_SG.tex  |
| 7     | descriptives.R                                           | create general descriptive statistics                                                                                                                                                                                                       |                                                                                                                                                                                  | voterfile\_full\_clean\_deid.rds,<br>pbdistricts.rds<br>                                                                                                                                           |                                                                                                      | turnout.pdf,<br>districtvotes.pdf,<br>age2.pdf, race2.pdf, hhinc2.pdf, college2.pdf |
| 8     | Paper\_text/online\_appendix.Rmd                         | Markdown file for robustness checks/online appendix                                                                                                                                                                                         | rr\_matching\_balance\_functions.R<br>                                                                                                                                           | voterfile\_for\_matching.rds,<br>matching\_res.RDS,<br>iter\_regress\_lmers.rds,<br>iter\_regress\_lmers\_within\_dist.rds,<br>iter\_regress\_lmers\_placebo.rds<br>iter\_regress\_lmers.rds |                                                                                                      | online\_appendix.html                                                               |
| 8a    | rr\_matching\_balance\_functions                         | helper functions for match balance comparison; label assignments                                                                                                                                                                            |                                                                                                                                                                                  |                                                                                                                                                                                              |                                                                                                      |                                                                                     |

